# Worklog — 2026-01-27

## Сделано
- Подключен middleware `DbSessionMiddleware`, сессия БД доступна в handlers.
- Реализован `UserService.ensure_user` (создание/обновление пользователя при /start).
- Добавлены стартовые inline-кнопки: «Создать бюджет», «Присоединиться», «Пригласить участника».
- Реализован FSM-поток создания бюджета (название → валюта → доп. валюты → таймзона → подтверждение).
- Добавлен сервис создания первого бюджета и DTO для валидации входных данных.
- Исправлены ошибки транзакций в сервисах бюджета и инвайтов.
- Добавлены инвайты: таблица `budget_invites`, миграция `0002`, сервисы генерации/принятия.
- Реализован инвайт-сценарий с подтверждением и сообщением: «@username пригласил вас в совместный бюджет».
- Присоединение по ссылке и через сценарий «Присоединиться» работает.
- Обновлены `docs/ux.md`, `docs/messages.md`, `docs/db_schema_v1.md`.
- Добавлено управление участниками: список и удаление участника владельцем.
- Добавлен активный бюджет: хранение в users.active_budget_id и экран выбора.
- Добавлены команды меню и reply‑клавиатура главного меню.

## Текущее состояние
- /start создаёт пользователя и показывает кнопки.
- Создание бюджета работает (создаются budget, membership, budget_counters).
- Инвайт-ссылка одноразовая на 24 часа, выдаётся владельцем, присоединение подтверждается.

## План на завтра
- Добавить управление участниками: просмотр списка и удаление участника владельцем.
- Добавить выбор активного бюджета (переключение) в настройках.
- Добавить базовый список категорий/источников и первые команды для их управления.
- Привести UX‑тексты к единому стилю после новых сценариев.
